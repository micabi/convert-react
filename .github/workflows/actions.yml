name: Jest & Stylelint & ESLint Github Actions

run-name: ${{ github.actor }} is Jest & Stylelint & ESLint testing out GitHub ActionsüöÄ

on:
  push:
    branches:
      - develop

env:
  SLACK_USERNAME: 'GitHub Actions'
  SLACK_ICON: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png
  SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}

jobs:
  Jest:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: initial setup
        uses: ./.github/workflows/common
      - name: Run Tests
        run: npm test
      - name: Show Status
        run: echo "üçè Jest job's status is ${{ job.status }}"

  Stylelint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: initial setup
        uses: ./.github/workflows/common
      - name: Run Stylelint
        run: npx stylelint "src/**/*.scss"
      - name: Show Status
        run: echo "üçè Stylelint job's is ${{ job.status }}"

  Eslint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: initial setup
        uses: ./.github/workflows/common
      - name: Run Eslint
        run: npx eslint .
      - name: Show Status
        run: echo "üçè Eslint job's is ${{ job.status }}"

  Build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: initial setup
        uses: ./.github/workflows/common
      - name: Run Build
        run: npm run build
      - name: Show Status
        run: echo "üçè Build job's is ${{ job.status }}"

  SlackNotification:
    runs-on: ubuntu-latest
    needs: [Jest, Stylelint, Eslint, Build]
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Slack Notification on Success
        uses: rtCamp/action-slack-notify@v2
        with:
          status: ${{ job.status }}
          author_name: ${{ github.actor }}
          author_link: ${{ github.actor }}
          title: ${{ job.status }} - ${{ github.repository }}
          fields: ${{ job.status }}
          text: ${{ job.status }} - ${{ github.repository }}
          color: ${{ job.status == 'success' && 'good' || 'danger' }}

        if: ${{ success()}}
        env:
          SLACK_TITLE: 'Jest & Stylelint & ESLint SUCCESS'
          SLACK_MESSAGE: 'All tests passed successfully'
          SLACK_COLOR: 'good'

      - name: Slack Notification on Failure
        uses: rtCamp/action-slack-notify@v2

        if: ${{ failure()}}
        env:
          SLACK_TITLE: 'Jest & Stylelint & ESLint FAILED'
          SLACK_MESSAGE: 'Some tests failed'
          SLACK_COLOR: 'danger'
